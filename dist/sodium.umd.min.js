!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("typescript-collections"),require("sanctuary-type-classes")):"function"==typeof define&&define.amd?define(["exports","typescript-collections","sanctuary-type-classes"],n):n(t.Sodium={},t.Collections,t.Z)}(this,function(t,n,e){"use strict";var r=0;var i,o=function(){function t(t,n){if(this.registered=!1,this.deregister_=null,null===t)throw new Error("null origin!");this.origin=t,this.register_=n}return t.prototype.register=function(t){var n=this;this.registered||(this.registered=!0,null!==this.register_?this.deregister_=this.register_():(this.origin.increment(t),this.deregister_=function(){return n.origin.decrement(t)}))},t.prototype.deregister=function(t){this.registered&&(this.registered=!1,null!==this.deregister_&&this.deregister_())},t}();(u=i||(i={}))[u.black=0]="black",u[u.gray=1]="gray",u[u.white=2]="white",u[u.purple=3]="purple";var u,s=[],c=0,a=function(){function t(t,n,e){this.targets=[],this.childrn=[],this.visited=!1,this.color=i.black,this.buffered=!1,this.refCountAdj=0,this.name=t,this.rank=n,this.sources=e,this.id=c++}return t.prototype.refCount=function(){return this.targets.length},t.prototype.register=function(t){return this.increment(t)},t.prototype.deregister=function(n){this.decrement(n),t.collectCycles()},t.prototype.incRefCount=function(t){var n=!1;if(0==this.refCount())for(var e=0;e<this.sources.length;e++)this.sources[e].register(this);return this.targets.push(t),t.childrn.push(this),t.ensureBiggerThan(this.rank)&&(n=!0),r++,n},t.prototype.decRefCount=function(t){for(var n=!1,e=0;e<t.childrn.length;e++)t.childrn[e]===this&&t.childrn.splice(e,1);for(e=0;e<this.targets.length;e++)if(this.targets[e]===t){this.targets.splice(e,1),n=!0;break}if(n){if(0==this.refCount())for(e=0;e<this.sources.length;e++)this.sources[e].deregister(this);r--}},t.prototype.addSource=function(t){this.sources.push(t),this.refCount()>0&&t.register(this)},t.prototype.ensureBiggerThan=function(t){if(this.rank>t||this.visited)return!1;this.visited=!0,this.rank=t+1;for(var n=0;n<this.targets.length;n++)this.targets[n].ensureBiggerThan(this.rank);return this.visited=!1,!0},t.prototype.descr=function(){var t=null;switch(this.color){case i.black:t="black";break;case i.gray:t="gray";break;case i.white:t="white";break;case i.purple:t="purple"}for(var n=this.id+" "+this.name+" ["+this.refCount()+"/"+this.refCountAdj+"] "+t+" ->",e=this.children(),r=0;r<e.length;r++)n=n+" "+e[r].id;return n},t.prototype.children=function(){return this.childrn},t.prototype.increment=function(t){return this.incRefCount(t)},t.prototype.decrement=function(t){this.decRefCount(t),0==this.refCount()?this.release():this.possibleRoots()},t.prototype.release=function(){this.color=i.black,this.buffered||this.free()},t.prototype.free=function(){for(;this.targets.length>0;)this.decRefCount(this.targets[0])},t.prototype.possibleRoots=function(){this.color!=i.purple&&(this.color=i.purple,this.buffered||(this.buffered=!0,s.push(this)))},t.collectCycles=function(){t.markRoots(),t.scanRoots(),t.collectRoots()},t.markRoots=function(){for(var t=[],n=0;n<s.length;n++)s[n].color==i.purple?(s[n].markGray(),t.push(s[n])):(s[n].buffered=!1,s[n].color==i.black&&0==s[n].refCount()&&s[n].free());s=t},t.scanRoots=function(){for(var t=0;t<s.length;t++)s[t].scan()},t.collectRoots=function(){for(var t=0;t<s.length;t++)s[t].buffered=!1,s[t].collectWhite();s=[]},t.prototype.markGray=function(){if(this.color!=i.gray){this.color=i.gray;for(var t=this.children(),n=0;n<t.length;n++)t[n].refCountAdj--,t[n].markGray()}},t.prototype.scan=function(){if(this.color==i.gray)if(this.refCount()+this.refCountAdj>0)this.scanBlack();else{this.color=i.white;for(var t=this.children(),n=0;n<t.length;n++)t[n].scan()}},t.prototype.scanBlack=function(){this.color=i.black;for(var t=this.children(),n=0;n<t.length;n++)t[n].refCountAdj++,t[n].color!=i.black&&t[n].scanBlack()},t.prototype.collectWhite=function(){if(this.color==i.white&&!this.buffered){0,this.color=i.black,this.refCountAdj=0;for(var t=this.children(),n=0;n<t.length;n++)t[n].collectWhite();this.free()}},t.NULL=new t("user",1e12,[]),t}(),l=function(){return function(t,n){this.f=t,this.deps=n}}();function f(t){return t instanceof l?t.deps:[]}function p(t){return t instanceof l?t.f:t}var h=function(){return function(t,n){this.f=t,this.deps=n}}();function _(t){return t instanceof h?t.deps:[]}function v(t){return t instanceof h?t.f:t}var y=function(){return function(t,n){this.f=t,this.deps=n}}();function d(t){return t instanceof y?t.deps:[]}function g(t){return t instanceof y?t.f:t}var m=function(){return function(t,n){this.f=t,this.deps=n}}();function w(t){return t instanceof m?t.deps:[]}function x(t){return t instanceof m?t.f:t}var T=function(){return function(t,n){this.f=t,this.deps=n}}();function V(t){return t instanceof T?t.deps:[]}function k(t){return t instanceof T?t.f:t}var S=function(){return function(t,n){this.f=t,this.deps=n}}();function b(t){return t instanceof S?t.deps:[]}function N(t){return t instanceof S?t.f:t}function C(t){for(var n=[],e=0;e<t.length;e++){var r=t[e];n.push(new o(r.getVertex__(),null))}return n}var z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])};function L(t,n){z(t,n);function e(){this.constructor=t}t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}var Q=function(){function t(n,e){this.rank=n,this.action=e,this.seq=t.nextSeq++}return t.prototype.toString=function(){return this.seq.toString()},t.nextSeq=0,t}(),R=function(){function t(){this.inCallback=0,this.toRegen=!1,this.prioritizedQ=new n.PriorityQueue(function(t,n){return t.rank.rank<n.rank.rank?1:t.rank.rank>n.rank.rank?-1:t.seq<n.seq?1:t.seq>n.seq?-1:0}),this.entries=new n.Set(function(t){return t.toString()}),this.lastQ=[],this.postQ=null}return t.prototype.requestRegen=function(){this.toRegen=!0},t.prototype.prioritized=function(t,n){var e=new Q(t,n);this.prioritizedQ.enqueue(e),this.entries.add(e)},t.prototype.last=function(t){this.lastQ.push(t)},t.prototype.post=function(t,n){for(null==this.postQ&&(this.postQ=[]);this.postQ.length<=t;)this.postQ.push(null);var e=this.postQ[t],r=null===e?n:function(){e(),n()};this.postQ[t]=r},t.prototype.checkRegen=function(){if(this.toRegen){this.toRegen=!1,this.prioritizedQ.clear();for(var t=this.entries.toArray(),n=0;n<t.length;n++)this.prioritizedQ.enqueue(t[n])}},t.prototype.isActive=function(){return!!t.currentTransaction},t.prototype.close=function(){for(;this.checkRegen(),!this.prioritizedQ.isEmpty();){var n=this.prioritizedQ.dequeue();this.entries.remove(n),n.action()}for(var e=0;e<this.lastQ.length;e++)this.lastQ[e]();if(this.lastQ=[],null!=this.postQ){for(e=0;e<this.postQ.length;e++)if(null!=this.postQ[e]){var r=t.currentTransaction;try{if(e>0){t.currentTransaction=new t;try{this.postQ[e](),t.currentTransaction.close()}catch(n){throw t.currentTransaction.close(),n}}else t.currentTransaction=null,this.postQ[e]();t.currentTransaction=r}catch(n){throw t.currentTransaction=r,n}}this.postQ=null}},t.onStart=function(n){t.onStartHooks.push(n)},t.run=function(n){var e=t.currentTransaction;if(null===e){if(!t.runningOnStartHooks){t.runningOnStartHooks=!0;try{for(var r=0;r<t.onStartHooks.length;r++)t.onStartHooks[r]()}finally{t.runningOnStartHooks=!1}}t.currentTransaction=new t}try{var i=n();return null===e&&(t.currentTransaction.close(),t.currentTransaction=null),i}catch(n){throw null===e&&(t.currentTransaction.close(),t.currentTransaction=null),n}},t.currentTransaction=null,t.onStartHooks=[],t.runningOnStartHooks=!1,t}(),q=function(){function t(t,n){this.f=v(t),this.out=n,this.out.getVertex__().sources=this.out.getVertex__().sources.concat(C(_(t))),this.accumValid=!1}return t.prototype.send_=function(t){var n=this;this.accumValid?this.accum=this.f(this.accum,t):(R.currentTransaction.prioritized(this.out.getVertex__(),function(){n.out.send_(n.accum),n.accumValid=!1,n.accum=null}),this.accum=t,this.accumValid=!0)},t}(),A=function(){function t(t){this.f=t}return t.prototype.get=function(){return this.f()},t.prototype.map=function(n){var e=this;return new t(function(){return n(e.f())})},t.prototype.lift=function(n,e){var r=this;return new t(function(){return e(r.f(),n.f())})},t.prototype.lift3=function(n,e,r){var i=this;return new t(function(){return r(i.f(),n.f(),e.f())})},t.prototype.lift4=function(n,e,r,i){var o=this;return new t(function(){return i(o.f(),n.f(),e.f(),r.f())})},t}(),U=function(){function t(){}return t.UNIT=new t,t}(),E=function(){function t(){}return t.updates=function(t){return t.getStream__()},t.value=function(n){return R.run(function(){var e=new P;R.currentTransaction.prioritized(e.getVertex__(),function(){e.send_(U.UNIT)});var r=e.snapshot1(n);return t.updates(n).orElse(r)})},t.defer=function(n){return t.split(n.map(function(t){return[t]}))},t.split=function(t){var n=new P(null);return n.setVertex__(new a("split",0,[new o(t.getVertex__(),function(){return t.listen_(n.getVertex__(),function(t){for(var e=function(e){R.currentTransaction.post(e,function(){R.run(function(){n.send_(t[e])})})},r=0;r<t.length;r++)e(r)},!1)})])),n},t}(),M=function(){return function(t){this.hasValue=!1,this.value=null,this.cell=t}}(),O=function(){return function(){this.f=null,this.f_present=!1,this.a=null,this.a_present=!1}}(),j=function(){function t(t,n){var e=this;this.value=t,n?R.run(function(){return e.setStream(n)}):(this.str=new B,this.vertex=new a("ConstCell",0,[]))}return t.prototype.setStream=function(t){var n=this;this.str=t;var e=this,r=new o(t.getVertex__(),function(){return t.listen_(e.vertex,function(t){null==e.valueUpdate&&R.currentTransaction.last(function(){e.value=e.valueUpdate,e.lazyInitValue=null,e.valueUpdate=null}),e.valueUpdate=t},!1)});this.vertex=new a("Cell",0,[r]),this.vertex.register(a.NULL),R.currentTransaction.last(function(){n.vertex.deregister(a.NULL)})},t.prototype.getVertex__=function(){return this.vertex},t.prototype.getStream__=function(){return this.str},t.prototype.sample=function(){var t=this;return R.run(function(){return t.sampleNoTrans__()})},t.prototype.sampleNoTrans__=function(){return this.value},t.prototype.sampleLazy=function(){var t=this;return R.run(function(){return t.sampleLazyNoTrans__()})},t.prototype.sampleLazyNoTrans__=function(){var t=this,n=new M(t);return R.currentTransaction.last(function(){n.value=null!=t.valueUpdate?t.valueUpdate:t.sampleNoTrans__(),n.hasValue=!0,n.cell=null}),new A(function(){return n.hasValue?n.value:n.cell.sample()})},t.prototype.map=function(t){var n=this;return R.run(function(){return E.updates(n).map(t).holdLazy(n.sampleLazy().map(p(t)))})},t.prototype.lift=function(n,e){var r=v(e),i=this.map(function(t){return function(n){return r(t,n)}});return t.apply(i,n,C(_(e)))},t.prototype.lift3=function(n,e,r){var i=g(r),o=this.map(function(t){return function(n){return function(e){return i(t,n,e)}}});return t.apply(t.apply(o,n),e,C(d(r)))},t.prototype.lift4=function(n,e,r,i){var o=x(i),u=this.map(function(t){return function(n){return function(e){return function(r){return o(t,n,e,r)}}}});return t.apply(t.apply(t.apply(u,n),e),r,C(w(i)))},t.prototype.lift5=function(n,e,r,i,o){var u=k(o),s=this.map(function(t){return function(n){return function(e){return function(r){return function(i){return u(t,n,e,r,i)}}}}});return t.apply(t.apply(t.apply(t.apply(s,n),e),r),i,C(V(o)))},t.prototype.lift6=function(n,e,r,i,o,u){var s=N(u),c=this.map(function(t){return function(n){return function(e){return function(r){return function(i){return function(o){return s(t,n,e,r,i,o)}}}}}});return t.apply(t.apply(t.apply(t.apply(t.apply(c,n),e),r),i),o,C(b(u)))},t.apply=function(t,n,e){return R.run(function(){var r=new O,i=new P,u=E.value(t),s=E.value(n),c=new o(u.getVertex__(),function(){return u.listen_(i.getVertex__(),function(t){r.f=t,r.f_present=!0,r.a_present&&i.send_(r.f(r.a))},!1)}),l=new o(s.getVertex__(),function(){return s.listen_(i.getVertex__(),function(t){r.a=t,r.a_present=!0,r.f_present&&i.send_(r.f(r.a))},!1)});return i.setVertex__(new a("apply",0,[c,l].concat(e||[]))),i.coalesce__(function(t,n){return n}).holdLazy(new A(function(){return t.sampleNoTrans__()(n.sampleNoTrans__())}))})},t.switchC=function(t){return R.run(function(){var n=t.sampleLazy().map(function(t){return t.sample()}),e=new P,r=null,i=E.value(t),u=new o(i.getVertex__(),function(){var t=null===r?null:E.value(r).listen_(e.getVertex__(),function(t){return e.send_(t)},!1),n=i.listen_(e.getVertex__(),function(n){r=n,null!==t&&t(),t=E.value(n).listen_(e.getVertex__(),function(t){return e.send_(t)},!1)},!1);return function(){n(),t()}});return e.setVertex__(new a("switchC",0,[u])),e.coalesce__(function(t,n){return n}).holdLazy(n)})},t.switchS=function(t){return R.run(function(){var n=new P,e=function(t){n.send_(t)},r=new o(t.getVertex__(),function(){var r=t.sampleNoTrans__().listen_(n.getVertex__(),e,!1),i=t.getStream__().listen_(n.getVertex__(),function(t){r(),r=t.listen_(n.getVertex__(),e,!0)},!1);return function(){i(),r()}});return n.setVertex__(new a("switchS",0,[r])),n})},t.prototype.listen=function(t){var n=this;return R.run(function(){return E.value(n).listen(t)})},t["fantasy-land/of"]=function(n){return new t(n)},t.prototype["fantasy-land/map"]=function(t){return this.map(t)},t.prototype["fantasy-land/ap"]=function(n){return t.apply(n,this)},t.prototype["fantasy-land/chain"]=function(n){return t.switchC(this.map(n))},t.prototype["fantasy-land/extend"]=function(n){return new t(n(this))},t.prototype["fantasy-land/extract"]=function(){return this.sample()},t}(),I=function(){return function(t,n){this.h=t,this.target=n}}(),H=function(t){L(n,t);function n(n,e){var r=t.call(this,null,null)||this;return R.run(function(){e&&r.setStream(e),r.lazyInitValue=n}),r}return n.prototype.sampleNoTrans__=function(){return null==this.value&&null!=this.lazyInitValue&&(this.value=this.lazyInitValue.get(),this.lazyInitValue=null),this.value},n}(j),B=function(){function t(t){this.listeners=[],this.firings=[],this.vertex=t||new a("Stream",0,[])}return t.prototype.getVertex__=function(){return this.vertex},t.prototype.map=function(t){var n=this,e=new P(null),r=p(t);return e.vertex=new a("map",0,[new o(this.vertex,function(){return n.listen_(e.vertex,function(t){e.send_(r(t))},!1)})].concat(C(f(t)))),e},t.prototype.mapTo=function(t){var n=this,e=new P(null);return e.vertex=new a("mapTo",0,[new o(this.vertex,function(){return n.listen_(e.vertex,function(n){e.send_(t)},!1)})]),e},t.prototype.orElse=function(t){return this.merge(t,function(t,n){return t})},t.prototype.merge_=function(t){var n=this,e=new P,r=new a("merge",0,[]);return r.sources.push(new o(this.vertex,function(){return n.listen_(r,function(t){e.send_(t)},!1)})),e.vertex.sources=e.vertex.sources.concat([new o(r,function(){return r.register(e.vertex),function(){r.deregister(e.vertex)}}),new o(t.vertex,function(){return t.listen_(e.vertex,function(t){e.send_(t)},!1)})]),e},t.prototype.coalesce__=function(t){var n=this,e=new P,r=new q(t,e);return e.vertex.sources=e.vertex.sources.concat([new o(this.vertex,function(){return n.listen_(e.vertex,function(t){r.send_(t)},!1)})]).concat(C(_(t))),e},t.prototype.merge=function(t,n){var e=this;return R.run(function(){return e.merge_(t).coalesce__(n)})},t.prototype.filter=function(t){var n=this,e=new P(null),r=p(t);return e.vertex=new a("filter",0,[new o(this.vertex,function(){return n.listen_(e.vertex,function(t){r(t)&&e.send_(t)},!1)})].concat(C(f(t)))),e},t.prototype.filterNotNull=function(){var t=this,n=new P(null);return n.vertex=new a("filterNotNull",0,[new o(this.vertex,function(){return t.listen_(n.vertex,function(t){null!==t&&n.send_(t)},!1)})]),n},t.prototype.gate=function(t){return this.snapshot(t,function(t,n){return n?t:null}).filterNotNull()},t.prototype.snapshot1=function(t){var n=this,e=new P(null);return e.vertex=new a("snapshot1",0,[new o(this.vertex,function(){return n.listen_(e.vertex,function(n){e.send_(t.sampleNoTrans__())},!1)}),new o(t.getVertex__(),null)]),e},t.prototype.snapshot=function(t,n){var e=this,r=new P(null),i=v(n);return r.vertex=new a("snapshot",0,[new o(this.vertex,function(){return e.listen_(r.vertex,function(n){r.send_(i(n,t.sampleNoTrans__()))},!1)}),new o(t.getVertex__(),null)].concat(C(_(n)))),r},t.prototype.snapshot3=function(t,n,e){var r=this,i=new P(null),u=g(e);return i.vertex=new a("snapshot",0,[new o(this.vertex,function(){return r.listen_(i.vertex,function(e){i.send_(u(e,t.sampleNoTrans__(),n.sampleNoTrans__()))},!1)}),new o(t.getVertex__(),null),new o(n.getVertex__(),null)].concat(C(d(e)))),i},t.prototype.snapshot4=function(t,n,e,r){var i=this,u=new P(null),s=x(r);return u.vertex=new a("snapshot",0,[new o(this.vertex,function(){return i.listen_(u.vertex,function(r){u.send_(s(r,t.sampleNoTrans__(),n.sampleNoTrans__(),e.sampleNoTrans__()))},!1)}),new o(t.getVertex__(),null),new o(n.getVertex__(),null),new o(e.getVertex__(),null)].concat(C(w(r)))),u},t.prototype.snapshot5=function(t,n,e,r,i){var u=this,s=new P(null),c=k(i);return s.vertex=new a("snapshot",0,[new o(this.vertex,function(){return u.listen_(s.vertex,function(i){s.send_(c(i,t.sampleNoTrans__(),n.sampleNoTrans__(),e.sampleNoTrans__(),r.sampleNoTrans__()))},!1)}),new o(t.getVertex__(),null),new o(n.getVertex__(),null),new o(e.getVertex__(),null),new o(r.getVertex__(),null)].concat(C(V(i)))),s},t.prototype.snapshot6=function(t,n,e,r,i,u){var s=this,c=new P(null),l=N(u);return c.vertex=new a("snapshot",0,[new o(this.vertex,function(){return s.listen_(c.vertex,function(o){c.send_(l(o,t.sampleNoTrans__(),n.sampleNoTrans__(),e.sampleNoTrans__(),r.sampleNoTrans__(),i.sampleNoTrans__()))},!1)}),new o(t.getVertex__(),null),new o(n.getVertex__(),null),new o(e.getVertex__(),null),new o(r.getVertex__(),null),new o(i.getVertex__(),null)].concat(C(b(u)))),c},t.prototype.hold=function(t){return new j(t,this)},t.prototype.holdLazy=function(t){return new H(t,this)},t.prototype.collect=function(t,n){return this.collectLazy(new A(function(){return t}),n)},t.prototype.collectLazy=function(t,n){var e=this;return R.run(function(){var r=new D,i=r.holdLazy(t),o=e.snapshot(i,n),u=o.map(function(t){return t.a}),s=o.map(function(t){return t.b});return r.loop(s),u})},t.prototype.accum=function(t,n){return this.accumLazy(new A(function(){return t}),n)},t.prototype.accumLazy=function(t,n){var e=this;return R.run(function(){var r=new D,i=r.holdLazy(t),o=e.snapshot(i,n);return r.loop(o),o.holdLazy(t)})},t.prototype.once=function(){var t=this;return R.run(function(){return t.gate(t.mapTo(!1).hold(!0))})},t.prototype.listen=function(t){var n=this;return R.run(function(){return n.listen_(a.NULL,t,!1)})},t.prototype.listen_=function(t,n,e){var r=this;this.vertex.register(t)&&R.currentTransaction.requestRegen();var i=new I(n,t);if(this.listeners.push(i),!e&&0!=this.firings.length){var o=this.firings.slice();R.currentTransaction.prioritized(t,function(){for(var t=0;t<o.length;t++)n(o[t])})}return function(){for(var n=!1,e=0;e<r.listeners.length;e++)if(r.listeners[e]==i){r.listeners.splice(e,1),n=!0;break}n&&r.vertex.deregister(t)}},t.prototype["fantasy-land/map"]=function(t){return this.map(t)},t.prototype["fantasy-land/concat"]=function(t){return this.merge(t,function(t,n){return e.Semigroup.test(t)?e.concat(t,n):t})},t.prototype["fantasy-land/empty"]=function(){return new t},t}(),P=function(t){L(n,t);function n(n){return t.call(this,n)||this}return n.prototype.setVertex__=function(t){this.vertex=t},n.prototype.send_=function(t){var n=this;if(0==this.vertex.refCount())throw new Error("send() was invoked before listeners were registered");0==this.firings.length&&R.currentTransaction.last(function(){n.firings=[]}),this.firings.push(t);for(var e=this.listeners.slice(),r=function(n){var r=e[n].h;R.currentTransaction.prioritized(e[n].target,function(){R.currentTransaction.inCallback++;try{r(t),R.currentTransaction.inCallback--}catch(t){throw R.currentTransaction.inCallback--,t}})},i=0;i<e.length;i++)r(i)},n}(B),D=function(t){L(n,t);function n(){var n=t.call(this)||this;if(n.assigned__=!1,n.vertex.name="StreamLoop",null===R.currentTransaction)throw new Error("StreamLoop/CellLoop must be used within an explicit transaction");return n}return n.prototype.loop=function(t){var n=this;if(this.assigned__)throw new Error("StreamLoop looped more than once");this.assigned__=!0,this.vertex.addSource(new o(t.getVertex__(),function(){return t.listen_(n.vertex,function(t){n.send_(t)},!1)}))},n}(P),G=function(t){L(n,t);function n(n){var e=t.call(this)||this;return n||(n=function(t,n){throw new Error("send() called more than once per transaction, which isn't allowed. Did you want to combine the events? Then pass a combining function to your StreamSink constructor.")}),e.coalescer=new q(n,e),e}return n.prototype.send=function(t){var n=this;R.run(function(){if(R.currentTransaction.inCallback>0)throw new Error("You are not allowed to use send() inside a Sodium callback");n.coalescer.send_(t)})},n}(P),W=function(t){L(n,t);function n(){return t.call(this,null,new D)||this}return n.prototype.loop=function(t){var n=this;R.run(function(){n.getStream__().loop(t.getStream__()),n.lazyInitValue=t.sampleLazy()})},n.prototype.sampleNoTrans__=function(){if(!this.getStream__().assigned__)throw new Error("CellLoop sampled before it was looped");return t.prototype.sampleNoTrans__.call(this)},n}(H),Y=function(t){L(n,t);function n(n,e){return t.call(this,n,new G(e))||this}return n.prototype.send=function(t){this.getStream__().send(t)},n}(j),Z=function(){return function(t,n){this.a=t,this.b=n}}(),F=function(){return function(){}}(),J=0,K=function(){return function(t,n){this.t=t,this.sAlarm=n,this.seq=++J}}(),X=function(){function t(t){var e=this;this.eventQueue=new n.BSTree(function(t,n){return t.t<n.t?-1:t.t>n.t?1:t.seq<n.seq?-1:t.seq>n.seq?1:0}),R.run(function(){e.impl=t,e.tMinimum=0;var n=new Y(t.now());e.time=n,e.time.listen(function(t){}),R.onStart(function(){for(var r=e.tMinimum=Math.max(e.tMinimum,t.now()),i=function(){var t=null;if(!e.eventQueue.isEmpty()){var i=e.eventQueue.minimum();i.t<=r&&(t=i)}if(null==t)return"break";n.send(t.t),R.run(function(){return t.sAlarm.send_(t.t)})};;){if("break"===i())break}n.send(r)})})}return t.prototype.at=function(t){var n=this,e=null,r=null,i=!1,u=null,s=!1,c=new P(null),l=function(){null!==r&&(r(),n.eventQueue.remove(e)),r=null,e=null,i&&(s||(s=!0,u=t.sampleNoTrans__()),null!==u&&(e=new K(u,c),n.eventQueue.add(e),r=n.impl.setTimer(u,function(){n.tMinimum=Math.max(n.tMinimum,u),R.run(function(){})})))};return c.setVertex__(new a("at",0,[new o(t.getVertex__(),function(){i=!0,s=!1,R.currentTransaction.prioritized(c.getVertex__(),l);var n=t.getStream__().listen_(c.getVertex__(),function(t){u=t,s=!0,l()},!1);return function(){i=!1,l(),n()}})])),c},t}(),$=function(t){L(n,t);function n(){return t.call(this,new tt)||this}return n}(X),tt=function(t){L(n,t);function n(){return null!==t&&t.apply(this,arguments)||this}return n.prototype.setTimer=function(t,n){var e=setTimeout(n,Math.max(1e3*(t-this.now()),0));return function(){clearTimeout(e)}},n.prototype.now=function(){return.001*Date.now()},n}(F),nt=function(t){L(n,t);function n(){return t.call(this,new et)||this}return n}(X),et=function(t){L(n,t);function n(){return null!==t&&t.apply(this,arguments)||this}return n.prototype.setTimer=function(t,n){var e=setTimeout(n,Math.max(t-this.now(),0));return function(){clearTimeout(e)}},n.prototype.now=function(){return Date.now()},n}(F),rt=function(){function t(){}return t.fromAsync=function(t){return function(n){var e=new P(null);return e.setVertex__(new a("map",0,[new o(n.getVertex__(),function(){return n.listen_(e.getVertex__(),function(n){t(n,function(t){R.run(function(){e.send_(t)})})},!1)})])),e}},t}();t.lambda1=function(t,n){return new l(t,n)},t.lambda2=function(t,n){return new h(t,n)},t.lambda3=function(t,n){return new y(t,n)},t.lambda4=function(t,n){return new m(t,n)},t.lambda5=function(t,n){return new T(t,n)},t.lambda6=function(t,n){return new S(t,n)},t.Stream=B,t.StreamLoop=D,t.StreamSink=G,t.Cell=j,t.CellLoop=W,t.CellSink=Y,t.Transaction=R,t.Tuple2=Z,t.Unit=U,t.Operational=E,t.getTotalRegistrations=function(){return r},t.Vertex=a,t.TimerSystemImpl=F,t.TimerSystem=X,t.SecondsTimerSystem=$,t.MillisecondsTimerSystem=nt,t.IOAction=rt,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=sodium.umd.min.js.map
